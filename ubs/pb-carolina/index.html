<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>PegaSenha • UBS Carolina Ramos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/style.css">
  <style>
    .titulo-centralizado { text-align:center; margin-bottom:8px; }
    .texto-inicial { text-align:center; font-size:1.05rem; margin-bottom:10px; }
    .alert-red { color:#b91c1c; font-weight:bold; }
    .btn-grande { padding:14px 26px; font-size:1.1rem; border-radius:12px; }
  </style>
</head>
<body>
  <main class="card">

    <!-- CABEÇALHO -->
    <header style="margin-bottom: 20px;">
      <h1 class="top-title titulo-centralizado">
        Pega<span class="brand-accent">Senha</span>
      </h1>

      <p class="texto-inicial">
        Este serviço organiza a fila de atendimento desta unidade.<br>
        Aqui você gera sua senha.
      </p>

      <!-- Texto removido conforme solicitado
      <p class="muted small">
        Este serviço organiza a fila de atendimento desta unidade.  
        Você gera sua senha aqui, aguarda nas proximidades da UBS e
        aguarda sua chamada pela equipe.
      </p>
      -->
    </header>

    <!-- FORMULÁRIO -->
    <section id="form-section">
      <p class="alert-red" style="text-align:center; margin-bottom:16px;">
        Preencha seus dados para entrar na fila desta unidade.
      </p>

      <form id="senha-form" class="form-layout">

        <label class="field">
          <span>Nome completo</span>
          <input id="nome" name="nome" type="text" required placeholder="Seu nome completo">
        </label>

        <label class="field">
          <span>Telefone (WhatsApp ou celular)</span>
          <input id="telefone" name="telefone" type="tel" required placeholder="(47) 9 9999-9999">
        </label>

        <label class="field">
          <span>Serviço desejado</span>
          <select id="servico" name="servico" required>
            <option value="">Selecione um serviço</option>
            <option value="medico">Atendimento médico</option>
            <option value="enfermagem">Enfermagem</option>
            <option value="farmacia">Farmácia</option>
            <option value="outro">Outro atendimento na UBS</option>
          </select>
        </label>

        <!-- Preferencial -->
        <fieldset class="field">
          <legend class="field-legend">Atendimento preferencial</legend>

          <label class="checkbox-line">
            <input type="checkbox" id="pref-checkbox">
            <span>Preciso de atendimento preferencial</span>
          </label>

          <label class="field" id="pref-tipo-wrapper" style="display:none; margin-top:8px;">
            <span>Motivo da prioridade</span>
            <select id="pref-tipo">
              <option value="">Selecione uma opção</option>
              <option value="idoso">Idoso (60+)</option>
              <option value="gestante">Gestante</option>
              <option value="pcd">Pessoa com deficiência</option>
              <option value="lactante">Lactante</option>
              <option value="crianca_colo">Pessoa com criança de colo</option>
              <option value="tea">Pessoa com TEA</option>
              <option value="outro">Outro motivo previsto em lei</option>
            </select>
          </label>
        </fieldset>

        <div id="form-erro" class="alert alert-error" style="display:none; margin-top:8px;"></div>

        <!-- BOTÃO GERAR SENHA -->
        <div style="margin-top: 20px; text-align:center;">
          <button id="btn-gerar" class="btn btn-grande" type="submit">
            GERAR SENHA
          </button>
        </div>

        <p class="muted small" style="margin-top: 16px; text-align:center;">
          <strong>
            Ao gerar sua senha, você concorda que deve permanecer nas proximidades desta UBS 
            e aguardar sua chamada pela equipe da unidade.
          </strong>
        </p>

      </form>
    </section>

    <!-- RESULTADO -->
    <section id="resultado-section" style="display:none;">
      <h2>Sua senha foi gerada</h2>

      <div class="ticket-box">
        <p class="ticket-label">Sua senha</p>
        <p id="ticket-numero" class="ticket-numero">—</p>

        <p id="ticket-servico" class="ticket-servico">Serviço: —</p>
        <p id="ticket-posicao" class="ticket-posicao">Posição na fila: —</p>
      </div>

      <p class="muted small" style="margin-top: 12px;">
        Aguarde nas proximidades da UBS Carolina Ramos.  
        Quando sua senha for chamada, dirija-se ao atendimento.
      </p>

      <div style="margin-top: 16px; text-align:center;">
        <button class="btn-secondary" type="button" onclick="voltarParaFormulario()">
          Gerar outra senha
        </button>
      </div>
    </section>

    <footer style="margin-top:24px; text-align:center;">
      <p class="muted small">
        PegaSenha é um sistema independente, disponibilizado gratuitamente para esta unidade.
      </p>
    </footer>
  </main>

  <!-- SCRIPT MANTIDO (MESMO COMPORTAMENTO) -->
  <script>
    const formEl = document.getElementById('senha-form');
    const formSection = document.getElementById('form-section');
    const resultadoSection = document.getElementById('resultado-section');
    const erroBox = document.getElementById('form-erro');
    const btnGerar = document.getElementById('btn-gerar');

    const prefCheckbox = document.getElementById('pref-checkbox');
    const prefTipoWrapper = document.getElementById('pref-tipo-wrapper');
    const prefTipoSelect = document.getElementById('pref-tipo');

    const ticketNumeroEl = document.getElementById('ticket-numero');
    const ticketServicoEl = document.getElementById('ticket-servico');
    const ticketPosicaoEl = document.getElementById('ticket-posicao');

    prefCheckbox.addEventListener('change', () => {
      prefTipoWrapper.style.display = prefCheckbox.checked ? 'block' : 'none';
      if (!prefCheckbox.checked) prefTipoSelect.value = '';
    });

    formEl.addEventListener('submit', function (event) {
      event.preventDefault();
      erroBox.style.display = 'none';
      erroBox.textContent = '';

      const nome = document.getElementById('nome').value.trim();
      const telefone = document.getElementById('telefone').value.trim();
      const servico = document.getElementById('servico').value;
      const pref = prefCheckbox.checked;
      const prefTipo = pref ? prefTipoSelect.value : null;

      if (!nome || !telefone || !servico) {
        return mostrarErro('Preencha nome, telefone e serviço.');
      }
      if (pref && !prefTipo) {
        return mostrarErro('Selecione o motivo da prioridade.');
      }

      btnGerar.disabled = true;
      btnGerar.textContent = 'Gerando...';

      setTimeout(() => {
        const r = simularRespostaAPI({ nome, telefone, servico, pref, prefTipo });

        if (r.erro) {
          mostrarErro(r.mensagem || 'Não foi possível gerar a senha.');
          btnGerar.disabled = false;
          btnGerar.textContent = 'GERAR SENHA';
          return;
        }

        ticketNumeroEl.textContent = r.senha;
        ticketServicoEl.textContent = 'Serviço: ' + r.servico_nome;
        ticketPosicaoEl.textContent = 'Posição na fila: ' + r.posicao + 'º';

        formSection.style.display = 'none';
        resultadoSection.style.display = 'block';

        btnGerar.disabled = false;
        btnGerar.textContent = 'GERAR SENHA';
      }, 800);
    });

    function mostrarErro(msg) {
      erroBox.textContent = msg;
      erroBox.style.display = 'block';
    }

    function voltarParaFormulario() {
      resultadoSection.style.display = 'none';
      formSection.style.display = 'block';
    }

    function simularRespostaAPI(d) {
      const numero = Math.floor(Date.now()/1000) % 100;
      const senha = numero < 10 ? '0'+numero : ''+numero;
      const nomes = {
        medico:'Atendimento médico', enfermagem:'Enfermagem',
        farmacia:'Farmácia', outro:'Outro atendimento'
      };
      return {
        senha, posicao: Math.floor(Math.random()*10)+1,
        servico_nome: nomes[d.servico]
      };
    }
  </script>
</body>
</html>
